<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
                xmlns:map="maps.*"
                xmlns:mine="components.*"
                creationComplete="initApp()">
    <mx:Script><![CDATA[
        import events.AuthenticationEvent;
        import models.AuthorizationData;
        import models.Config;

        [Bindable]
        public var authorizationData:AuthorizationData = new AuthorizationData();
        [Bindable]
        public var properties:Config = new Config();

        private var loader:URLLoader = new URLLoader();

        public function initApp():void {
            loader.load(new URLRequest('application-context.properties'));
            loader.addEventListener(Event.COMPLETE, onLoaderComplete);
            loader.addEventListener(IOErrorEvent.IO_ERROR, onIOError);
        }

        private function onLoaderComplete(event:Event):void {
            var content:String = String(loader.data);
            properties.host = "localhost";
            properties.port = "8080";
            properties.webcontext = "books-web";

            var authEvent:AuthenticationEvent = new AuthenticationEvent(AuthenticationEvent.CHECK_NEEDS);
            dispatchEvent(authEvent);
        }

        private function onIOError(event:IOErrorEvent):void {
          dispatchEvent(event);
        }

        ]]></mx:Script>

    <map:MainEventMap props="{properties}"/>
    <map:SecurityEventMap props="{properties}"/>

    <mine:MainScreen width="100%" height="100%"/>
</mx:Application>